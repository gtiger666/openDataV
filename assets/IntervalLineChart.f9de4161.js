var h=(g,a,n)=>new Promise((m,e)=>{var l=p=>{try{i(n.next(p))}catch(c){e(c)}},d=p=>{try{i(n.throw(p))}catch(c){e(c)}},i=p=>p.done?m(p.value):Promise.resolve(p.value).then(l,d);i((n=n.apply(g,a)).next())});import{V as S,W as M}from"./echarts.b68702ec.js";import{a as O}from"./@vueuse.f12362bf.js";import{h as v}from"./index.59cf4f9c.js";import{c as E,w as x}from"./index.8c99d488.js";import{t as _}from"./mydark.8efe4250.js";import{p as I,r as k,q as z,w as A,o as T,y as B,x as D}from"./@vue.93899e90.js";import"./zrender.aa8f9b3b.js";import"./tslib.34a40861.js";import"./axios.19d3e859.js";import"./vue-router.62208e1c.js";import"./pinia.7738838c.js";import"./vue-demi.b3a9cad9.js";import"./mitt.550594b0.js";import"./element-plus.da7f9641.js";import"./lodash.1a3e162a.js";import"./nprogress.5f640c6a.js";import"./async-validator.5d25c98b.js";import"./@popperjs.a8a4a6a0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./lodash-es.ef547d44.js";const se=I({props:{element:null,propValue:null},setup(g){const a=g;S("mydark",_);const n=E(),m=k(null);let e=null,l=[],d,i=[];z(()=>h(this,null,function*(){yield p(),w(),clearInterval(d),d=setInterval(V,a.propValue.interval)}));const p=()=>h(this,null,function*(){let s=null;try{s=JSON.parse(a.propValue.data)}catch(t){x(t.message)}if(s){const t=a.propValue.history;try{yield j(t,s)}catch(o){if(console.log(o),n.isEditMode){l=[],i=[];for(let r=0;r<100;r++)l.push(Math.round(Math.random()*600)),i.push(String(r))}}finally{yield V()}}});O(m,s=>{const t=s[0],{width:o,height:r}=t.contentRect;e==null||e.resize({width:o,height:r})});const c=()=>{let s=[],t=[];const o=i.length;for(let f=0;f<o;f++)a.propValue.highflag&&s.push(a.propValue.highflag),a.propValue.lowflag&&t.push(a.propValue.lowflag);let r={grid:{top:"10%",left:"3%",right:"4%",bottom:"10%",containLabel:!0},title:{text:a.propValue.title,subtext:a.propValue.subTitle,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:i},yAxis:{type:"value"},series:[]},u=[{data:l,type:"line",symbol:"none",smooth:!0}];return t.length>0&&u.push({data:t,type:"line",symbol:"none"}),s.length>0&&u.push({data:s,type:"line",symbol:"none"}),r.series=u,r},j=(s,t)=>h(this,null,function*(){const o=a.propValue.method?a.propValue.method:"GET";let r;o==="GET"?r=yield v.get({url:s,params:t}):r=yield v.post({url:s,data:t});const f=JSON.parse(r)[0].Records;l=[],i=[],f.map(y=>(l.push(parseInt(y.Values._value)),i.push(y.Values._time),{time:y.Values._time,value:parseInt(y.Values._value)}))}),V=()=>h(this,null,function*(){let s=c(),t=null;try{t=JSON.parse(a.propValue.data)}catch(o){x(o.message)}if(t){const o=a.propValue.history;try{yield j(o,t)}catch(r){if(n.isEditMode){l=[],i=[];for(let u=0;u<100;u++)l.push(Math.round(Math.random()*600)),i.push(String(u))}}finally{s.series[0].data=l,e&&e.setOption({xAxis:{data:i},series:s.series})}}}),w=()=>{e=M(m.value,"mydark"),e.clear(),e.setOption(c())};let b=()=>{console.log("stop")};return n.isEditMode&&(b=A(()=>a.propValue,()=>{e&&(e.clear(),e.setOption(c()))},{deep:!0})),T(()=>{clearInterval(d),b(),e&&(e.clear(),e.dispose())}),(s,t)=>(D(),B("div",{ref:(o,r)=>{r.chartEl=o,m.value=o}},null,512))}});export{se as default};
