var j=(h,t,p)=>new Promise((c,o)=>{var f=i=>{try{l(p.next(i))}catch(u){o(u)}},n=i=>{try{l(p.throw(i))}catch(u){o(u)}},l=i=>i.done?c(i.value):Promise.resolve(i.value).then(f,n);l((p=p.apply(h,t)).next())});import{V as E,W as T}from"./echarts.b68702ec.js";import{a as M}from"./@vueuse.f12362bf.js";import{h as O}from"./index.59cf4f9c.js";import{c as S,u as k,e as y}from"./index.8c99d488.js";import{t as D}from"./mydark.8efe4250.js";import{d as z}from"./lodash-es.ef547d44.js";import{p as B,r as x,q as R,w as _,o as A,y as C,x as W,n as q}from"./@vue.93899e90.js";import"./zrender.aa8f9b3b.js";import"./tslib.34a40861.js";import"./axios.19d3e859.js";import"./vue-router.62208e1c.js";import"./pinia.7738838c.js";import"./vue-demi.b3a9cad9.js";import"./mitt.550594b0.js";import"./element-plus.da7f9641.js";import"./lodash.1a3e162a.js";import"./nprogress.5f640c6a.js";import"./async-validator.5d25c98b.js";import"./@popperjs.a8a4a6a0.js";import"./resize-observer-polyfill.8deb1e21.js";const le=B({props:{element:null,propValue:null},setup(h){const t=h;E("mydark",D);const p=x(null),c=x([]);let o=null,f=[],n=[],l=new Map;const i=S(),u=e=>{const a=e;if(t.propValue.subtag){const s=Number(t.propValue.upperLimit),r=Number(t.propValue.lowerLimit);if(RegExp(t.propValue.subtag).test(a.TagName)){const m=y(Number(a.TagValue),s,r),N=Number(a.TagName.replace(/\D/gi,""))-1;l.set(N,m),b()}}};R(()=>j(this,null,function*(){v(),yield w(),L()})),k("actual",u);const v=()=>{for(let e=1;e<=t.propValue.total;e++)c.value.push(t.propValue.subtag.replace("[1-9]",e))},w=()=>j(this,null,function*(){try{const e=yield O.post({url:t.propValue.history,data:c.value}),a=Number(t.propValue.upperLimit),s=Number(t.propValue.lowerLimit);e.ErrorCode===200&&(f=e.Results||[],n=f.map(r=>y(Number(r.TagValue),a,s)))}catch(e){console.log((e==null?void 0:e.message)||e);for(let a=0;a<t.propValue.total;a++)n.push(Math.round(Math.random()*600))}finally{b()}});M(p,e=>{const a=e[0],{width:s,height:r}=a.contentRect;q(()=>{o&&(o==null||o.resize({width:s,height:r}))})});const g=()=>{let e=[],a=[],s=[];for(let m=0;m<t.propValue.total;m++)e.push(String(m+1)),t.propValue.highflag&&a.push(t.propValue.highflag),t.propValue.lowflag&&(s.push(t.propValue.lowflag),b());let r={grid:{top:"10%",left:"3%",right:"4%",bottom:"10%",containLabel:!0},title:{text:t.propValue.title,subtext:t.propValue.subTitle,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:e},yAxis:{type:"value"},series:[]},d=[{data:n,type:"bar"}];return s.length>0&&d.push({data:s,type:"line",symbol:"none"}),a.length>0&&d.push({data:a,type:"line",symbol:"none"}),r.series=d,r},b=z(()=>{const e=g(),a=e.series[0].data.length;l.forEach((s,r)=>{r<a&&(e.series[0].data[r]=s)}),l=new Map,o&&o.setOption({series:e.series})},300),L=()=>{o=T(p.value,"mydark"),o.setOption(g())};let V;return i.isEditMode&&(V=_(()=>t.propValue,(e,a)=>{console.log(e),o&&(o.clear(),o.setOption(g()))},{deep:!0})),A(()=>{V&&V(),o&&(o.clear(),o.dispose())}),(e,a)=>(W(),C("div",{ref:(s,r)=>{r.chartEl=s,p.value=s}},null,512))}});export{le as default};
